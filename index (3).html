<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ä»£è¿è¥ç¥å™¨-åŒ…å­</title>
    <script src="https://cdn.jsdelivr.net/npm/marked@4.0.0/marked.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            darkMode: 'media',
            theme: {
                extend: {
                    colors: {
                        primary: '#5D5CDE',
                    }
                }
            }
        }
    </script>
    <style>
        /* Custom variables */
        :root {
            --primary: #5D5CDE;
        }
        
        .dark .preview-content {
            background-color: #2d2d2d;
            color: #f3f3f3;
        }
        
        .light .preview-content {
            background-color: #f9f9f9;
            color: #333333;
        }
        
        .preview-content {
            font-family: system-ui, -apple-system, sans-serif;
            padding: 1rem;
            border-radius: 0.375rem;
            overflow-y: auto;
            word-break: break-word;
        }
        
        /* æ”¹å–„æ®µè½æ˜¾ç¤º */
        .preview-content p {
            margin-bottom: 1em;
            line-height: 1.6;
        }
        
        .preview-content h1, 
        .preview-content h2, 
        .preview-content h3, 
        .preview-content h4, 
        .preview-content h5, 
        .preview-content h6 {
            margin-top: 1.5em;
            margin-bottom: 0.75em;
        }
        
        .preview-content img {
            max-width: 100%;
            height: auto;
        }
        
        .preview-content pre {
            padding: 1rem;
            overflow-x: auto;
            border-radius: 0.25rem;
        }
        
        .preview-content code {
            font-family: monospace;
        }
        
        .preview-content table {
            border-collapse: collapse;
            width: 100%;
        }
        
        .preview-content th, .preview-content td {
            border: 1px solid #ddd;
            padding: 8px;
        }
        
        .preview-content blockquote {
            border-left: 4px solid #ccc;
            padding-left: 1rem;
            color: #666;
        }
        
        @media (prefers-color-scheme: dark) {
            .preview-content blockquote {
                border-left-color: #555;
                color: #bbb;
            }
            .preview-content th, .preview-content td {
                border-color: #555;
            }
        }
    </style>
</head>
<body class="min-h-screen bg-white dark:bg-gray-900 text-gray-900 dark:text-gray-100">
    <!-- ç™»å½•ç•Œé¢ -->
    <div id="login-container" class="flex items-center justify-center min-h-screen">
        <div class="w-full max-w-md p-6 bg-white dark:bg-gray-800 rounded-lg shadow-lg">
            <div class="text-center mb-8">
                <h1 class="text-3xl font-bold text-primary">ä»£è¿è¥ç¥å™¨-åŒ…å­ ğŸ¥Ÿ</h1>
                <p class="text-gray-600 dark:text-gray-400 mt-2">è¯·ç™»å½•åä½¿ç”¨</p>
            </div>
            
            <div class="flex justify-center gap-4 mb-6">
                <button id="admin-login-tab" class="px-4 py-2 bg-primary text-white rounded-lg">ç®¡ç†å‘˜ç™»å½•</button>
                <button id="user-login-tab" class="px-4 py-2 bg-gray-200 dark:bg-gray-700 text-gray-800 dark:text-gray-200 rounded-lg">ç”¨æˆ·ç™»å½•</button>
            </div>
            
            <!-- ç®¡ç†å‘˜ç™»å½•è¡¨å• -->
            <div id="admin-login-form">
                <div class="mb-4">
                    <label class="block text-gray-700 dark:text-gray-300 mb-2" for="admin-username">ç®¡ç†å‘˜è´¦å·</label>
                    <div class="relative">
                        <input id="admin-username" type="password" class="w-full px-4 py-2 border rounded-lg dark:bg-gray-700 dark:border-gray-600 dark:text-gray-200 text-base" placeholder="è¾“å…¥ç®¡ç†å‘˜è´¦å·">
                        <button type="button" class="toggle-password absolute inset-y-0 right-0 px-3 flex items-center text-gray-600 dark:text-gray-400 focus:outline-none" data-target="admin-username">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 eye-open" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z" />
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z" />
                            </svg>
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 eye-closed hidden" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13.875 18.825A10.05 10.05 0 0112 19c-4.478 0-8.268-2.943-9.543-7a9.97 9.97 0 011.563-3.029m5.858.908a3 3 0 114.243 4.243M9.878 9.878l4.242 4.242M9.88 9.88l-3.29-3.29m7.532 7.532l3.29 3.29M3 3l3.59 3.59m0 0A9.953 9.953 0 0112 5c4.478 0 8.268 2.943 9.543 7a10.025 10.025 0 01-4.132 5.411m0 0L21 21" />
                            </svg>
                        </button>
                    </div>
                </div>
                <div class="mb-4">
                    <label class="block text-gray-700 dark:text-gray-300 mb-2" for="admin-password">ç®¡ç†å‘˜å¯†ç </label>
                    <div class="relative">
                        <input id="admin-password" type="password" class="w-full px-4 py-2 border rounded-lg dark:bg-gray-700 dark:border-gray-600 dark:text-gray-200 text-base" placeholder="è¾“å…¥ç®¡ç†å‘˜å¯†ç ">
                        <button type="button" class="toggle-password absolute inset-y-0 right-0 px-3 flex items-center text-gray-600 dark:text-gray-400 focus:outline-none" data-target="admin-password">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 eye-open" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z" />
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z" />
                            </svg>
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 eye-closed hidden" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13.875 18.825A10.05 10.05 0 0112 19c-4.478 0-8.268-2.943-9.543-7a9.97 9.97 0 011.563-3.029m5.858.908a3 3 0 114.243 4.243M9.878 9.878l4.242 4.242M9.88 9.88l-3.29-3.29m7.532 7.532l3.29 3.29M3 3l3.59 3.59m0 0A9.953 9.953 0 0112 5c4.478 0 8.268 2.943 9.543 7a10.025 10.025 0 01-4.132 5.411m0 0L21 21" />
                            </svg>
                        </button>
                    </div>
                </div>
                <div class="mb-4 flex items-center">
                    <input id="remember-admin" type="checkbox" class="h-4 w-4 text-primary border-gray-300 focus:ring-primary">
                    <label for="remember-admin" class="ml-2 block text-sm text-gray-700 dark:text-gray-300">è®°ä½è´¦å·å¯†ç </label>
                </div>
                <button id="admin-login-btn" class="w-full py-2 bg-primary text-white rounded-lg hover:bg-opacity-90 transition-colors">ç™»å½•ç®¡ç†å‘˜è´¦å·</button>
            </div>
            
            <!-- ç”¨æˆ·ç™»å½•è¡¨å• -->
            <div id="user-login-form" class="hidden">
                <div class="mb-4">
                    <label class="block text-gray-700 dark:text-gray-300 mb-2" for="card-key">å¡å¯†</label>
                    <div class="relative">
                        <input id="card-key" type="password" class="w-full px-4 py-2 border rounded-lg dark:bg-gray-700 dark:border-gray-600 dark:text-gray-200 text-base" placeholder="è¾“å…¥å¡å¯†">
                        <button type="button" class="toggle-password absolute inset-y-0 right-0 px-3 flex items-center text-gray-600 dark:text-gray-400 focus:outline-none" data-target="card-key">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 eye-open" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z" />
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z" />
                            </svg>
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 eye-closed hidden" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13.875 18.825A10.05 10.05 0 0112 19c-4.478 0-8.268-2.943-9.543-7a9.97 9.97 0 011.563-3.029m5.858.908a3 3 0 114.243 4.243M9.878 9.878l4.242 4.242M9.88 9.88l-3.29-3.29m7.532 7.532l3.29 3.29M3 3l3.59 3.59m0 0A9.953 9.953 0 0112 5c4.478 0 8.268 2.943 9.543 7a10.025 10.025 0 01-4.132 5.411m0 0L21 21" />
                            </svg>
                        </button>
                    </div>
                </div>
                <div class="mb-4 flex items-center">
                    <input id="remember-user" type="checkbox" class="h-4 w-4 text-primary border-gray-300 focus:ring-primary">
                    <label for="remember-user" class="ml-2 block text-sm text-gray-700 dark:text-gray-300">è®°ä½å¡å¯†</label>
                </div>
                <button id="user-login-btn" class="w-full py-2 bg-primary text-white rounded-lg hover:bg-opacity-90 transition-colors">éªŒè¯ç™»å½•</button>
            </div>
            
            <div class="mt-4 text-center">
                <p class="text-xs text-gray-500 dark:text-gray-400">Â© 2025 ä»£è¿è¥ç¥å™¨-åŒ…å­</p>
            </div>
        </div>
    </div>
    
    <!-- ç®¡ç†å‘˜å¡å¯†ç®¡ç†ç•Œé¢ -->
    <div id="admin-panel" class="hidden min-h-screen">
        <div class="container mx-auto px-4 py-8 max-w-5xl">
            <div class="flex justify-between items-center mb-8">
                <h1 class="text-3xl font-bold text-primary">å¡å¯†ç®¡ç†ç³»ç»Ÿ</h1>
                <div class="flex gap-3">
                    <button id="enter-app-btn" class="px-4 py-2 bg-primary text-white rounded-lg hover:bg-opacity-90 transition-colors">
                        è¿›å…¥åº”ç”¨
                    </button>
                    <button id="logout-admin-btn" class="px-4 py-2 bg-gray-500 dark:bg-gray-700 text-white rounded-lg hover:bg-opacity-90 transition-colors">
                        é€€å‡ºç™»å½•
                    </button>
                </div>
            </div>
            
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-6">
                <div class="p-4 bg-white dark:bg-gray-800 rounded-lg shadow">
                    <h2 class="text-xl font-semibold mb-4">ç”Ÿæˆå¡å¯†</h2>
                    <div class="mb-4">
                        <label class="block text-gray-700 dark:text-gray-300 mb-2" for="card-count">æ•°é‡</label>
                        <input id="card-count" type="number" min="1" max="100" value="5" class="w-full px-4 py-2 border rounded-lg dark:bg-gray-700 dark:border-gray-600 dark:text-gray-200 text-base">
                    </div>
                    <div class="mb-4">
                        <label class="block text-gray-700 dark:text-gray-300 mb-2" for="card-expiry">æœ‰æ•ˆæœŸ(å¤©)</label>
                        <input id="card-expiry" type="number" min="1" value="30" class="w-full px-4 py-2 border rounded-lg dark:bg-gray-700 dark:border-gray-600 dark:text-gray-200 text-base">
                    </div>
                    <button id="generate-keys-btn" class="w-full py-2 bg-primary text-white rounded-lg hover:bg-opacity-90 transition-colors">ç”Ÿæˆå¡å¯†</button>
                </div>
                
                <div class="md:col-span-2 p-4 bg-white dark:bg-gray-800 rounded-lg shadow">
                    <div class="flex justify-between items-center mb-4">
                        <h2 class="text-xl font-semibold">å¡å¯†åˆ—è¡¨</h2>
                        <div class="flex gap-2">
                            <button id="export-keys-btn" class="px-3 py-1 bg-primary text-white rounded-lg hover:bg-opacity-90 transition-colors text-sm">
                                å¯¼å‡ºå¡å¯†
                            </button>
                            <button id="import-keys-btn" class="px-3 py-1 bg-gray-500 dark:bg-gray-700 text-white rounded-lg hover:bg-opacity-90 transition-colors text-sm">
                                å¯¼å…¥å¡å¯†
                            </button>
                        </div>
                    </div>
                    <div class="overflow-x-auto">
                        <table class="min-w-full bg-white dark:bg-gray-800">
                            <thead>
                                <tr class="bg-gray-100 dark:bg-gray-700 text-gray-800 dark:text-gray-200">
                                    <th class="py-2 px-4 border-b text-left">å¡å¯†</th>
                                    <th class="py-2 px-4 border-b text-left">ç”Ÿæˆæ—¶é—´</th>
                                    <th class="py-2 px-4 border-b text-left">è¿‡æœŸæ—¶é—´</th>
                                    <th class="py-2 px-4 border-b text-left">çŠ¶æ€</th>
                                </tr>
                            </thead>
                            <tbody id="keys-table-body">
                                <tr class="text-gray-700 dark:text-gray-300">
                                    <td colspan="4" class="py-4 px-4 border-b text-center">æš‚æ— å¡å¯†æ•°æ®</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- ä¸»åº”ç”¨ç•Œé¢ -->
    <div id="app-container" class="hidden">
        <div class="container mx-auto px-4 py-8 max-w-6xl">
        <h1 class="text-3xl font-bold text-center mb-2 text-primary">ä»£è¿è¥ç¥å™¨-åŒ…å­ ğŸ¥Ÿ</h1>
        <p class="text-center mb-8 text-gray-600 dark:text-gray-400">å¿«é€Ÿè½¬æ¢æ–‡æœ¬æ ¼å¼ï¼Œè½»æ¾å¤„ç†å†…å®¹</p>
        
        <div class="grid grid-cols-1 md:grid-cols-12 gap-6">
            <div class="flex flex-col h-full md:col-span-5">
                <div class="flex justify-between items-center mb-2">
                    <h2 class="text-xl font-semibold">è¾“å…¥ (Markdown æˆ– HTML)</h2>
                    <div class="flex gap-2">
                        <button id="import-btn" class="px-3 py-1 bg-primary text-white rounded hover:bg-opacity-90 transition-colors">
                            å¯¼å…¥æ–‡ä»¶
                        </button>
                        <button id="clear-btn" class="px-3 py-1 bg-gray-500 dark:bg-gray-700 text-white rounded hover:bg-opacity-90 transition-colors">
                            æ¸…ç©º
                        </button>
                    </div>
                </div>
                <!-- æ–‡ä»¶åæ˜¾ç¤ºåŒºåŸŸ -->
                <div id="current-file-name" class="mb-2 px-1 text-primary font-medium hidden"></div>
                <textarea id="input-text" class="flex-grow p-4 border dark:border-gray-700 rounded-md bg-white dark:bg-gray-800 text-gray-900 dark:text-gray-100 resize-none text-base" placeholder="åœ¨æ­¤å¤„è¾“å…¥æˆ–ç²˜è´´æ‚¨çš„ Markdown æˆ– HTML å†…å®¹..."></textarea>
                <div class="mt-4 flex gap-2">
                    <button id="to-html-btn" class="px-4 py-2 bg-primary text-white rounded hover:bg-opacity-90 transition-colors">
                        è½¬æ¢ä¸º HTML
                    </button>
                    <button id="to-markdown-btn" class="px-4 py-2 bg-primary text-white rounded hover:bg-opacity-90 transition-colors">
                        è½¬æ¢ä¸º Markdown
                    </button>
                </div>
                <input type="file" id="file-input" class="hidden" accept=".md,.markdown,.txt,.html">
            </div>
            
            <div class="flex flex-col h-full md:col-span-5">
                <div class="flex justify-between items-center mb-2">
                    <h2 class="text-xl font-semibold">é¢„è§ˆ</h2>
                    <div class="flex gap-2">
                        <button id="copy-html-btn" class="px-3 py-1 bg-primary text-white rounded hover:bg-opacity-90 transition-colors">
                            å¤åˆ¶ HTML
                        </button>
                        <button id="copy-preview-btn" class="px-3 py-1 bg-primary text-white rounded hover:bg-opacity-90 transition-colors">
                            å¤åˆ¶é¢„è§ˆå†…å®¹
                        </button>
                    </div>
                </div>
                <div class="border dark:border-gray-700 rounded-md flex-grow flex flex-col">
                    <div class="p-2 border-b dark:border-gray-700 bg-gray-100 dark:bg-gray-800 flex flex-wrap md:flex-nowrap justify-between">
                        <div class="flex gap-2 mb-2 md:mb-0">
                            <button id="preview-tab" class="px-3 py-1 bg-primary text-white rounded hover:bg-opacity-90 transition-colors">
                                é¢„è§ˆ
                            </button>
                            <button id="html-tab" class="px-3 py-1 bg-gray-300 dark:bg-gray-700 text-gray-800 dark:text-gray-200 rounded hover:bg-opacity-90 transition-colors">
                                HTML
                            </button>
                            <button id="css-btn" class="px-3 py-1 bg-gray-300 dark:bg-gray-700 text-gray-800 dark:text-gray-200 rounded hover:bg-opacity-90 transition-colors">
                                è‡ªå®šä¹‰CSS
                            </button>
                        </div>
                        <div class="flex-shrink-0 flex items-center whitespace-nowrap">
                            <span class="text-sm text-gray-600 dark:text-gray-400 mr-2">é¢„è§ˆæ¨¡å¼ï¼š</span>
                            <div class="flex gap-2">
                                <button id="pc-preview-btn" class="px-3 py-1 bg-primary text-white rounded hover:bg-opacity-90 transition-colors text-sm">
                                    <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 inline" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9.75 17L9 20l-1 1h8l-1-1-.75-3M3 13h18M5 17h14a2 2 0 002-2V5a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z" />
                                    </svg>
                                    ç”µè„‘
                                </button>
                                <button id="mobile-preview-btn" class="px-3 py-1 bg-gray-300 dark:bg-gray-700 text-gray-800 dark:text-gray-200 rounded hover:bg-opacity-90 transition-colors text-sm">
                                    <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 inline" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 18h.01M8 21h8a2 2 0 002-2V5a2 2 0 00-2-2H8a2 2 0 00-2 2v14a2 2 0 002 2z" />
                                    </svg>
                                    æ‰‹æœº
                                </button>
                            </div>
                        </div>
                    </div>
                    <div id="preview-container" class="flex-grow flex justify-center">
                        <div id="nice" class="preview-content w-full dark:bg-gray-800 bg-white"></div>
                        <div id="mobile-container" class="hidden flex-grow flex items-center justify-center py-4">
                            <div class="shadow-md mx-auto overflow-y-auto border dark:border-gray-700 rounded" style="width: 375px; max-width: 100%; height: auto; max-height: 80vh;">
                                <div id="nice" class="preview-content bg-white dark:bg-gray-800 mobile-view"></div>
                            </div>
                        </div>
                        <textarea id="html-content" class="hidden p-4 w-full bg-white dark:bg-gray-800 text-gray-900 dark:text-gray-100 text-base resize-none" readonly></textarea>
                    </div>
                </div>
            </div>
            
            <!-- å³ä¾§CSSç¼–è¾‘åŒºåŸŸ - é‡æ–°å¸ƒå±€ä¸ºå‚ç›´å¯æŠ˜å çš„è®¾è®¡ -->
            <div id="css-container" class="flex flex-col h-full md:col-span-2 hidden">
                <div class="flex flex-col mb-2">
                    <div class="flex justify-between items-center mb-2">
                        <h2 class="text-lg font-semibold flex items-center">
                            è‡ªå®šä¹‰CSS
                            <button id="toggle-css-editor" class="ml-2 px-2 py-0.5 bg-gray-200 dark:bg-gray-700 text-gray-800 dark:text-gray-200 rounded hover:bg-opacity-90 transition-colors text-xs">
                                <span id="toggle-icon">ğŸ“•</span>
                            </button>
                        </h2>
                        <div class="flex gap-2">
                            <button id="apply-css-btn" class="px-3 py-1 bg-primary text-white rounded hover:bg-opacity-90 transition-colors text-sm">
                                åº”ç”¨CSS
                            </button>
                            <button id="save-css-btn" class="px-3 py-1 bg-primary text-white rounded hover:bg-opacity-90 transition-colors text-sm">
                                ä¿å­˜CSS
                            </button>
                            <button id="reset-css-btn" class="px-3 py-1 bg-gray-500 dark:bg-gray-700 text-white rounded hover:bg-opacity-90 transition-colors text-sm">
                                é‡ç½®
                            </button>
                        </div>
                    </div>
                </div>
                <div id="css-editor-container" class="flex-grow">
                    <textarea id="custom-css" class="w-full h-96 p-4 border dark:border-gray-700 rounded-md bg-white dark:bg-gray-800 text-gray-900 dark:text-gray-100 resize-vertical text-base" placeholder="åœ¨æ­¤å¤„è¾“å…¥è‡ªå®šä¹‰CSSæ ·å¼..."></textarea>
                </div>
            </div>
        </div>
        
        <div class="mt-8">
            <h3 class="text-lg font-semibold mb-2">æ¨¡æ¿è®¾ç½®</h3>
            <div class="grid grid-cols-1 gap-4">
                <div class="border dark:border-gray-700 rounded-md p-4">
                    <div class="flex justify-between items-center mb-3">
                        <h4 class="font-medium text-primary">æ–‡ç« æ¨¡æ¿æ ·å¼ç®¡ç†</h4>
                        <div class="flex gap-2">
                            <button id="export-all-btn" class="px-3 py-1 bg-primary text-white rounded hover:bg-opacity-90 transition-colors text-sm flex items-center">
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 mr-1" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4" />
                                </svg>
                                å¯¼å‡ºæ‰€æœ‰è®¾ç½®
                            </button>
                            <button id="import-all-btn" class="px-3 py-1 bg-gray-500 dark:bg-gray-700 text-white rounded hover:bg-opacity-90 transition-colors text-sm flex items-center">
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 mr-1" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-8l-4-4m0 0L4 8m4-4v12" />
                                </svg>
                                å¯¼å…¥è®¾ç½®
                            </button>
                        </div>
                    </div>
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                        <div class="border dark:border-gray-700 rounded-md p-3">
                            <div class="mb-2">
                                <h5 class="font-medium">å¤´éƒ¨æ ·å¼ (top)</h5>
                            </div>
                            <div class="flex items-center gap-2 mb-2">
                                <button id="upload-top-btn" class="px-2 py-1 bg-gray-200 dark:bg-gray-700 text-gray-800 dark:text-gray-200 rounded hover:bg-opacity-90 transition-colors text-sm flex-1">ä¸Šä¼ æ–‡ä»¶</button>
                                <input type="file" id="top-file-input" class="hidden" accept=".txt,.md,.html,.template" multiple>
                            </div>
                            <div class="flex items-center gap-2">
                                <select id="top-template-select" class="px-2 py-1 border dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-800 dark:text-gray-200 rounded text-sm flex-1">
                                    <option value="">-- é€‰æ‹©æ¨¡æ¿ --</option>
                                </select>
                                <button id="apply-top-btn" class="px-2 py-1 bg-primary text-white rounded hover:bg-opacity-90 transition-colors text-sm">åº”ç”¨</button>
                            </div>
                            <div class="mt-2 text-xs text-gray-500 dark:text-gray-400" id="top-file-count">å·²ä¸Šä¼ : 0ä¸ªæ–‡ä»¶</div>
                        </div>
                        
                        <div class="border dark:border-gray-700 rounded-md p-3">
                            <div class="mb-2">
                                <h5 class="font-medium">å°æ ‡é¢˜æ ·å¼ (h2)</h5>
                            </div>
                            <div class="flex items-center gap-2 mb-2">
                                <button id="upload-h2-btn" class="px-2 py-1 bg-gray-200 dark:bg-gray-700 text-gray-800 dark:text-gray-200 rounded hover:bg-opacity-90 transition-colors text-sm flex-1">ä¸Šä¼ æ–‡ä»¶</button>
                                <input type="file" id="h2-file-input" class="hidden" accept=".txt,.md,.html,.template" multiple>
                            </div>
                            <div class="flex items-center gap-2">
                                <select id="h2-template-select" class="px-2 py-1 border dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-800 dark:text-gray-200 rounded text-sm flex-1">
                                    <option value="">-- é€‰æ‹©æ¨¡æ¿ --</option>
                                </select>
                                <button id="apply-h2-btn" class="px-2 py-1 bg-primary text-white rounded hover:bg-opacity-90 transition-colors text-sm">åº”ç”¨</button>
                            </div>
                            <div class="mt-2 text-xs text-gray-500 dark:text-gray-400" id="h2-file-count">å·²ä¸Šä¼ : 0ä¸ªæ–‡ä»¶</div>
                        </div>
                        
                        <div class="border dark:border-gray-700 rounded-md p-3">
                            <div class="mb-2">
                                <h5 class="font-medium">å°¾éƒ¨æ ·å¼ (bottom)</h5>
                            </div>
                            <div class="flex items-center gap-2 mb-2">
                                <button id="upload-bottom-btn" class="px-2 py-1 bg-gray-200 dark:bg-gray-700 text-gray-800 dark:text-gray-200 rounded hover:bg-opacity-90 transition-colors text-sm flex-1">ä¸Šä¼ æ–‡ä»¶</button>
                                <input type="file" id="bottom-file-input" class="hidden" accept=".txt,.md,.html,.template" multiple>
                            </div>
                            <div class="flex items-center gap-2">
                                <select id="bottom-template-select" class="px-2 py-1 border dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-800 dark:text-gray-200 rounded text-sm flex-1">
                                    <option value="">-- é€‰æ‹©æ¨¡æ¿ --</option>
                                </select>
                                <button id="apply-bottom-btn" class="px-2 py-1 bg-primary text-white rounded hover:bg-opacity-90 transition-colors text-sm">åº”ç”¨</button>
                            </div>
                            <div class="mt-2 text-xs text-gray-500 dark:text-gray-400" id="bottom-file-count">å·²ä¸Šä¼ : 0ä¸ªæ–‡ä»¶</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <footer class="mt-10 text-center text-gray-600 dark:text-gray-400 text-sm">
            <p>ä»£è¿è¥ç¥å™¨-åŒ…å­ | ç”¨â¤ï¸åˆ¶ä½œ</p>
            <p class="text-xs mt-1 text-gray-500 dark:text-gray-500">Â© 2025 ä»£è¿è¥ç¥å™¨-åŒ…å­</p>
        </footer>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            // ç™»å½•ç³»ç»Ÿç›¸å…³å…ƒç´ 
            const loginContainer = document.getElementById('login-container');
            const adminPanel = document.getElementById('admin-panel');
            const appContainer = document.getElementById('app-container');
            
            // ç™»å½•è¡¨å•ç›¸å…³å…ƒç´ 
            const adminLoginTab = document.getElementById('admin-login-tab');
            const userLoginTab = document.getElementById('user-login-tab');
            const adminLoginForm = document.getElementById('admin-login-form');
            const userLoginForm = document.getElementById('user-login-form');
            const adminUsername = document.getElementById('admin-username');
            const adminPassword = document.getElementById('admin-password');
            const cardKey = document.getElementById('card-key');
            const adminLoginBtn = document.getElementById('admin-login-btn');
            const userLoginBtn = document.getElementById('user-login-btn');
            
            // ç®¡ç†å‘˜é¢æ¿ç›¸å…³å…ƒç´ 
            const enterAppBtn = document.getElementById('enter-app-btn');
            const logoutAdminBtn = document.getElementById('logout-admin-btn');
            const cardCount = document.getElementById('card-count');
            const cardExpiry = document.getElementById('card-expiry');
            const generateKeysBtn = document.getElementById('generate-keys-btn');
            const exportKeysBtn = document.getElementById('export-keys-btn');
            const importKeysBtn = document.getElementById('import-keys-btn');
            const keysTableBody = document.getElementById('keys-table-body');
            
            // åˆ›å»ºä¸€ä¸ªéšè—çš„æ–‡ä»¶è¾“å…¥å…ƒç´ ï¼Œç”¨äºå¯¼å…¥å¡å¯†
            const keysFileInput = document.createElement('input');
            keysFileInput.type = 'file';
            keysFileInput.accept = '.json';
            keysFileInput.style.display = 'none';
            document.body.appendChild(keysFileInput);
            
            // ç®¡ç†å‘˜ä¿¡æ¯ï¼ˆè¿™åº”è¯¥ä»æœåŠ¡å™¨è·å–ï¼Œä½†åœ¨è¿™é‡Œç¡¬ç¼–ç ï¼‰
            const adminCredentials = {
                username: '16673039641',
                password: 'ss641520'
            };
            
            // å¡å¯†ä¿¡æ¯å­˜å‚¨
            let cardKeys = [];
            
            // ç”Ÿæˆè®¾å¤‡æŒ‡çº¹ï¼Œç”¨äºæ ‡è¯†ä¸åŒçš„è®¾å¤‡
            function generateDeviceFingerprint() {
                const userAgent = navigator.userAgent;
                const language = navigator.language;
                const platform = navigator.platform;
                const screenWidth = window.screen.width;
                const screenHeight = window.screen.height;
                const colorDepth = window.screen.colorDepth;
                const timezone = Intl.DateTimeFormat().resolvedOptions().timeZone;
                // ç»„åˆè¿™äº›ä¿¡æ¯ç”Ÿæˆä¸€ä¸ªè¾ƒä¸ºå”¯ä¸€çš„æŒ‡çº¹
                const rawFingerprint = `${userAgent}|${language}|${platform}|${screenWidth}x${screenHeight}|${colorDepth}|${timezone}`;
                
                // ä½¿ç”¨ç®€å•çš„å“ˆå¸Œå‡½æ•°å°†åŸå§‹æŒ‡çº¹è½¬æ¢ä¸ºå›ºå®šé•¿åº¦çš„å­—ç¬¦ä¸²
                function simpleHash(str) {
                    let hash = 0;
                    if (str.length === 0) return hash;
                    for (let i = 0; i < str.length; i++) {
                        const char = str.charCodeAt(i);
                        hash = ((hash << 5) - hash) + char;
                        hash = hash & hash; // Convert to 32bit integer
                    }
                    return Math.abs(hash).toString(16); // è½¬ä¸º16è¿›åˆ¶å­—ç¬¦ä¸²
                }
                
                return simpleHash(rawFingerprint);
            }
            
            // è·å–å½“å‰è®¾å¤‡çš„æŒ‡çº¹
            const currentDeviceFingerprint = generateDeviceFingerprint();
            
            // ç®¡ç†ç™»å½•çŠ¶æ€ï¼ˆä¼šè¯ä¸­ï¼‰
            let isLoggedIn = false;
            let isAdmin = false;
            
            // ç™»å½•è¡¨å•åˆ‡æ¢
            adminLoginTab.addEventListener('click', () => {
                adminLoginTab.classList.add('bg-primary', 'text-white');
                adminLoginTab.classList.remove('bg-gray-200', 'dark:bg-gray-700', 'text-gray-800', 'dark:text-gray-200');
                userLoginTab.classList.remove('bg-primary', 'text-white');
                userLoginTab.classList.add('bg-gray-200', 'dark:bg-gray-700', 'text-gray-800', 'dark:text-gray-200');
                
                adminLoginForm.classList.remove('hidden');
                userLoginForm.classList.add('hidden');
            });
            
            userLoginTab.addEventListener('click', () => {
                userLoginTab.classList.add('bg-primary', 'text-white');
                userLoginTab.classList.remove('bg-gray-200', 'dark:bg-gray-700', 'text-gray-800', 'dark:text-gray-200');
                adminLoginTab.classList.remove('bg-primary', 'text-white');
                adminLoginTab.classList.add('bg-gray-200', 'dark:bg-gray-700', 'text-gray-800', 'dark:text-gray-200');
                
                userLoginForm.classList.remove('hidden');
                adminLoginForm.classList.add('hidden');
            });
            
            // ç®¡ç†å‘˜ç™»å½•å¤„ç†
            adminLoginBtn.addEventListener('click', () => {
                const username = adminUsername.value.trim();
                const password = adminPassword.value.trim();
                
                if (!username || !password) {
                    alert('è¯·è¾“å…¥ç®¡ç†å‘˜è´¦å·å’Œå¯†ç ');
                    return;
                }
                
                if (username === adminCredentials.username && password === adminCredentials.password) {
                    isLoggedIn = true;
                    isAdmin = true;
                    
                    // å¦‚æœé€‰æ‹©äº†è®°ä½è´¦å·å¯†ç 
                    if (rememberAdmin.checked) {
                        try {
                            // ä¿å­˜åˆ°localStorage
                            localStorage.setItem('adminCredentials', JSON.stringify({
                                username: username,
                                password: password
                            }));
                        } catch (error) {
                            console.error('ä¿å­˜ç®¡ç†å‘˜è´¦å·å¯†ç å¤±è´¥:', error);
                        }
                    } else {
                        // æ¸…é™¤ä¹‹å‰ä¿å­˜çš„è®°å½•
                        try {
                            localStorage.removeItem('adminCredentials');
                        } catch (error) {
                            console.error('æ¸…é™¤ç®¡ç†å‘˜è´¦å·å¯†ç å¤±è´¥:', error);
                        }
                    }
                    
                    // æ˜¾ç¤ºç®¡ç†å‘˜é¢æ¿
                    loginContainer.classList.add('hidden');
                    adminPanel.classList.remove('hidden');
                    
                    // æ›´æ–°å¡å¯†è¡¨æ ¼
                    updateCardKeysTable();
                } else {
                    alert('ç®¡ç†å‘˜è´¦å·æˆ–å¯†ç é”™è¯¯');
                }
            });
            
            // ç™»å‡ºå¤„ç†
            logoutAdminBtn.addEventListener('click', () => {
                isLoggedIn = false;
                isAdmin = false;
                
                // æ¸…ç©ºç™»å½•è¡¨å•
                adminUsername.value = '';
                adminPassword.value = '';
                cardKey.value = '';
                
                // æ˜¾ç¤ºç™»å½•ç•Œé¢
                adminPanel.classList.add('hidden');
                appContainer.classList.add('hidden');
                loginContainer.classList.remove('hidden');
                
                // é‡ç½®è¡¨å•åˆ°ç®¡ç†å‘˜ç™»å½•
                adminLoginTab.click();
            });
            
            // è¿›å…¥åº”ç”¨æŒ‰é’®
            enterAppBtn.addEventListener('click', () => {
                adminPanel.classList.add('hidden');
                appContainer.classList.remove('hidden');
            });
            
            // ç”¨æˆ·ç™»å½•ï¼ˆå¡å¯†éªŒè¯ï¼‰å¤„ç†
            userLoginBtn.addEventListener('click', () => {
                const key = cardKey.value.trim();
                
                if (!key) {
                    alert('è¯·è¾“å…¥å¡å¯†');
                    return;
                }
                
                // æ·»åŠ è°ƒè¯•ä¿¡æ¯ï¼ŒæŸ¥çœ‹æ‰€æœ‰å¡å¯†
                console.log('å½“å‰æ‰€æœ‰å¡å¯†:', JSON.stringify(cardKeys));
                console.log('å½“å‰è®¾å¤‡æŒ‡çº¹:', currentDeviceFingerprint);
                
                // éªŒè¯å¡å¯† - ä½¿ç”¨ä¸åŒºåˆ†å¤§å°å†™çš„æ¯”è¾ƒ
                const validKey = cardKeys.find(k => 
                    k.key.toUpperCase() === key.toUpperCase() && 
                    k.status === 'æœ‰æ•ˆ' && 
                    new Date(k.expiryDate) > new Date()
                );
                
                // æ£€æŸ¥æ˜¯å¦æ˜¯å·²ä½¿ç”¨çš„å¡å¯†ï¼Œä½†åœ¨å½“å‰è®¾å¤‡ä¸Šä½¿ç”¨è¿‡ï¼ˆå…è®¸åŒä¸€è®¾å¤‡é‡å¤ä½¿ç”¨ï¼‰
                const usedKeyOnThisDevice = cardKeys.find(k => 
                    k.key.toUpperCase() === key.toUpperCase() && 
                    k.status === 'å·²ä½¿ç”¨' &&
                    k.deviceId === currentDeviceFingerprint &&
                    new Date(k.expiryDate) > new Date()
                );
                
                if (validKey || usedKeyOnThisDevice) {
                    isLoggedIn = true;
                    isAdmin = false;
                    
                    // æ ‡è®°å¡å¯†ä¸ºå·²ä½¿ç”¨ï¼Œå¹¶å…³è”åˆ°å½“å‰è®¾å¤‡
                    if (validKey) {
                        validKey.status = 'å·²ä½¿ç”¨';
                        validKey.deviceId = currentDeviceFingerprint;
                    }
                    
                    // å¦‚æœé€‰æ‹©äº†è®°ä½å¡å¯†
                    if (rememberUser.checked) {
                        try {
                            localStorage.setItem('userCardKey', key);
                        } catch (error) {
                            console.error('ä¿å­˜å¡å¯†å¤±è´¥:', error);
                        }
                    } else {
                        try {
                            localStorage.removeItem('userCardKey');
                        } catch (error) {
                            console.error('æ¸…é™¤å¡å¯†å¤±è´¥:', error);
                        }
                    }
                    
                    // æ¸…ç©ºå¡å¯†è¾“å…¥
                    cardKey.value = '';
                    
                    // æ˜¾ç¤ºåº”ç”¨ç•Œé¢
                    loginContainer.classList.add('hidden');
                    appContainer.classList.remove('hidden');
                    
                    // å¦‚æœæ˜¯ç®¡ç†å‘˜ï¼Œä¹Ÿè¦æ›´æ–°å¡å¯†è¡¨æ ¼
                    if (adminPanel.classList.contains('hidden') === false) {
                        updateCardKeysTable();
                    }
                    
                    alert(`ç™»å½•æˆåŠŸï¼æ¬¢è¿ä½¿ç”¨ä»£è¿è¥ç¥å™¨-åŒ…å­`);
                } else {
                    // è°ƒè¯•: æ‰“å°ç”¨æˆ·è¾“å…¥çš„å¡å¯†
                    console.log('ç”¨æˆ·å°è¯•ä½¿ç”¨çš„å¡å¯†:', key);
                    
                    // æ£€æŸ¥å¡å¯†æ˜¯å¦å­˜åœ¨ä½†å·²è¿‡æœŸæˆ–å·²ä½¿ç”¨ - ä¸åŒºåˆ†å¤§å°å†™
                    const existingKey = cardKeys.find(k => k.key.toUpperCase() === key.toUpperCase());
                    if (existingKey) {
                        if (existingKey.status === 'å·²ä½¿ç”¨') {
                            if (existingKey.deviceId && existingKey.deviceId !== currentDeviceFingerprint) {
                                alert('è¯¥å¡å¯†å·²åœ¨å…¶ä»–è®¾å¤‡ä¸Šä½¿ç”¨ï¼Œä¸€ä¸ªå¡å¯†åªèƒ½åœ¨ä¸€å°è®¾å¤‡ä¸Šä½¿ç”¨');
                            } else {
                                alert('å¡å¯†å·²è¢«ä½¿ç”¨');
                            }
                        } else if (new Date(existingKey.expiryDate) <= new Date()) {
                            alert('å¡å¯†å·²è¿‡æœŸ');
                        } else {
                            alert('å¡å¯†éªŒè¯å¤±è´¥ï¼Œè¯·è”ç³»ç®¡ç†å‘˜');
                        }
                    } else {
                        alert('æ— æ•ˆçš„å¡å¯†ï¼Œè¯·ç¡®è®¤è¾“å…¥æ­£ç¡®');
                    }
                }
            });
            
            // ç”Ÿæˆå¡å¯†
            generateKeysBtn.addEventListener('click', () => {
                const count = parseInt(cardCount.value) || 5;
                const days = parseInt(cardExpiry.value) || 30;
                
                if (count <= 0 || count > 100) {
                    alert('ç”Ÿæˆæ•°é‡åº”åœ¨1-100ä¹‹é—´');
                    return;
                }
                
                if (days <= 0) {
                    alert('æœ‰æ•ˆæœŸå¿…é¡»å¤§äº0å¤©');
                    return;
                }
                
                // ç”Ÿæˆå¡å¯†
                const newKeys = generateKeys(count, days);
                cardKeys = [...cardKeys, ...newKeys];
                
                // æ›´æ–°è¡¨æ ¼
                updateCardKeysTable();
                
                // æ˜¾ç¤ºç”Ÿæˆçš„å¡å¯†
                let keysMessage = `æˆåŠŸç”Ÿæˆ${count}ä¸ªå¡å¯†ï¼š\n\n`;
                newKeys.forEach(key => {
                    keysMessage += `${key.key}\n`;
                });
                alert(keysMessage);
                
                // æ˜¾ç¤ºæˆåŠŸæ¶ˆæ¯
                alert(`æˆåŠŸç”Ÿæˆ${count}ä¸ªå¡å¯†`);
            });
            
            // æ›´æ–°å¡å¯†è¡¨æ ¼
            function updateCardKeysTable() {
                console.log('æ›´æ–°å¡å¯†è¡¨æ ¼:', cardKeys); // è°ƒè¯•ä¿¡æ¯
                
                // æ¸…ç©ºè¡¨æ ¼
                keysTableBody.innerHTML = '';
                
                if (cardKeys.length === 0) {
                    keysTableBody.innerHTML = `
                        <tr class="text-gray-700 dark:text-gray-300">
                            <td colspan="4" class="py-4 px-4 border-b text-center">æš‚æ— å¡å¯†æ•°æ®</td>
                        </tr>
                    `;
                    return;
                }
                
                // æŒ‰åˆ›å»ºæ—¶é—´é™åºæ’åº
                const sortedKeys = [...cardKeys].sort((a, b) => 
                    new Date(b.createdDate).getTime() - new Date(a.createdDate).getTime()
                );
                
                // å¡«å……è¡¨æ ¼
                sortedKeys.forEach(key => {
                    const row = document.createElement('tr');
                    row.className = 'text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700';
                    
                    // ç¡®å®šçŠ¶æ€æ ·å¼
                    let statusClass = '';
                    if (key.status === 'æœ‰æ•ˆ') {
                        statusClass = 'text-green-600 dark:text-green-400';
                    } else if (key.status === 'å·²ä½¿ç”¨') {
                        statusClass = 'text-yellow-600 dark:text-yellow-400';
                    } else if (key.status === 'å·²è¿‡æœŸ') {
                        statusClass = 'text-red-600 dark:text-red-400';
                    }
                    
                    // æ£€æŸ¥æ˜¯å¦å·²è¿‡æœŸ
                    const now = new Date();
                    const expiryDate = new Date(key.expiryDate);
                    if (expiryDate < now && key.status === 'æœ‰æ•ˆ') {
                        key.status = 'å·²è¿‡æœŸ';
                        statusClass = 'text-red-600 dark:text-red-400';
                    }
                    
                    // æ ¼å¼åŒ–æ—¥æœŸ
                    const formatDate = (dateString) => {
                        const date = new Date(dateString);
                        return date.toLocaleString('zh-CN');
                    };
                    
                    // æ˜¾ç¤ºè®¾å¤‡ä¿¡æ¯ï¼ˆå¦‚æœæœ‰ï¼‰
                    const deviceInfo = key.deviceId ? 
                        `<span class="text-xs text-gray-500 dark:text-gray-400 block mt-1">${
                            key.deviceId === currentDeviceFingerprint ? 
                            '(å½“å‰è®¾å¤‡)' : 
                            '(å…¶ä»–è®¾å¤‡)'
                        }</span>` : '';
                    
                    row.innerHTML = `
                        <td class="py-2 px-4 border-b font-mono">${key.key}</td>
                        <td class="py-2 px-4 border-b">${formatDate(key.createdDate)}</td>
                        <td class="py-2 px-4 border-b">${formatDate(key.expiryDate)}</td>
                        <td class="py-2 px-4 border-b ${statusClass}">
                            ${key.status}
                            ${key.status === 'å·²ä½¿ç”¨' ? deviceInfo : ''}
                        </td>
                    `;
                    
                    keysTableBody.appendChild(row);
                });
            }
            
            // ç”Ÿæˆéšæœºå¡å¯†å‡½æ•°
            function generateKeys(count, days) {
                const keys = [];
                const now = new Date();
                const expiry = new Date(now);
                expiry.setDate(expiry.getDate() + days);
                
                for (let i = 0; i < count; i++) {
                    // åˆ›å»ºä¸€ä¸ªå¡å¯†å¯¹è±¡
                    const newKey = {
                        key: generateRandomKey(),
                        createdDate: now.toISOString(),
                        expiryDate: expiry.toISOString(),
                        status: 'æœ‰æ•ˆ'
                    };
                    
                    // ç¡®ä¿ç”Ÿæˆçš„å¡å¯†æ˜¾ç¤ºåœ¨ç®¡ç†ç•Œé¢ä¸­
                    console.log('ç”Ÿæˆæ–°å¡å¯†:', newKey.key);
                    keys.push(newKey);
                }
                
                return keys;
            }
            
            // ç”Ÿæˆå•ä¸ªéšæœºå¡å¯†
            function generateRandomKey() {
                // ç”Ÿæˆå½¢å¦‚ XXXX-XXXX-XXXX-XXXX çš„å¡å¯†ï¼Œå…¶ä¸­Xä¸ºå¤§å†™å­—æ¯æˆ–æ•°å­—
                const chars = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789';
                let key = '';
                
                for (let i = 0; i < 4; i++) {
                    for (let j = 0; j < 4; j++) {
                        key += chars.charAt(Math.floor(Math.random() * chars.length));
                    }
                    if (i < 3) key += '-';
                }
                
                return key;
            }
            
            // å¯¼å‡ºå¡å¯†
            exportKeysBtn.addEventListener('click', () => {
                try {
                    if (cardKeys.length === 0) {
                        alert('æ²¡æœ‰å¡å¯†å¯å¯¼å‡º');
                        return;
                    }
                    
                    // å¯¼å‡ºä¸ºJSON
                    const keysData = {
                        timestamp: new Date().toISOString(),
                        keys: cardKeys
                    };
                    
                    const keysJson = JSON.stringify(keysData, null, 2);
                    const blob = new Blob([keysJson], { type: 'application/json' });
                    
                    // åˆ›å»ºä¸‹è½½é“¾æ¥
                    const url = URL.createObjectURL(blob);
                    const a = document.createElement('a');
                    a.href = url;
                    a.download = `card-keys-${new Date().toISOString().slice(0, 10)}.json`;
                    
                    // è§¦å‘ä¸‹è½½å¹¶æ¸…ç†
                    document.body.appendChild(a);
                    a.click();
                    document.body.removeChild(a);
                    URL.revokeObjectURL(url);
                    
                    alert('å¡å¯†å¯¼å‡ºæˆåŠŸ');
                } catch (error) {
                    console.error('å¯¼å‡ºå¡å¯†å¤±è´¥:', error);
                    alert('å¯¼å‡ºå¡å¯†å¤±è´¥: ' + error.message);
                }
            });
            
            // å¯¼å…¥å¡å¯†
            importKeysBtn.addEventListener('click', () => {
                keysFileInput.click();
            });
            
            keysFileInput.addEventListener('change', (event) => {
                const file = event.target.files[0];
                if (!file) return;
                
                const reader = new FileReader();
                reader.onload = function(e) {
                    try {
                        const data = JSON.parse(e.target.result);
                        
                        // éªŒè¯æ–‡ä»¶æ ¼å¼
                        if (!data.keys || !Array.isArray(data.keys)) {
                            throw new Error('æ— æ•ˆçš„å¡å¯†æ–‡ä»¶æ ¼å¼');
                        }
                        
                        // åˆå¹¶å¯¼å…¥çš„å¡å¯†ï¼Œä¿ç•™å·²æœ‰å¡å¯†ï¼ˆé¿å…é‡å¤ï¼‰
                        const existingKeys = new Set(cardKeys.map(k => k.key));
                        
                        // è¿‡æ»¤å‡ºæ–°çš„å¡å¯†
                        const newKeys = data.keys.filter(k => !existingKeys.has(k.key));
                        
                        // åˆå¹¶å¡å¯†åˆ—è¡¨
                        cardKeys = [...cardKeys, ...newKeys];
                        
                        // æ›´æ–°è¡¨æ ¼
                        updateCardKeysTable();
                        
                        alert(`æˆåŠŸå¯¼å…¥${newKeys.length}ä¸ªå¡å¯†ï¼Œå·²å¿½ç•¥${data.keys.length - newKeys.length}ä¸ªé‡å¤å¡å¯†`);
                    } catch (error) {
                        console.error('å¯¼å…¥å¡å¯†å¤±è´¥:', error);
                        alert('å¯¼å…¥å¡å¯†å¤±è´¥: ' + error.message);
                    }
                };
                reader.readAsText(file);
                
                // æ¸…ç©ºæ–‡ä»¶è¾“å…¥ï¼Œä»¥ä¾¿å†æ¬¡é€‰æ‹©åŒä¸€æ–‡ä»¶
                keysFileInput.value = '';
            });
            
            // å›è½¦é”®ç™»å½•
            adminPassword.addEventListener('keyup', (event) => {
                if (event.key === 'Enter') {
                    adminLoginBtn.click();
                }
            });
            
            cardKey.addEventListener('keyup', (event) => {
                if (event.key === 'Enter') {
                    userLoginBtn.click();
                }
            });
            
            // è·å–è®°ä½ç™»å½•ç›¸å…³å…ƒç´ 
            const rememberAdmin = document.getElementById('remember-admin');
            const rememberUser = document.getElementById('remember-user');
            
            // æ£€æŸ¥æ˜¯å¦å·²æœ‰é»˜è®¤å¡å¯†ï¼Œå¦‚æœæ²¡æœ‰åˆ™æ·»åŠ ä¸€ä¸ªæµ‹è¯•å¡å¯†
            if (cardKeys.length === 0) {
                const now = new Date();
                const expiry = new Date(now);
                expiry.setFullYear(expiry.getFullYear() + 1); // é»˜è®¤æµ‹è¯•å¡å¯†æœ‰æ•ˆæœŸ1å¹´
                
                cardKeys.push({
                    key: 'TEST-1234-ABCD-5678',
                    createdDate: now.toISOString(),
                    expiryDate: expiry.toISOString(),
                    status: 'æœ‰æ•ˆ'
                });
            }
            
            // è®°ä½ç™»å½•åŠŸèƒ½
            try {
                // æ£€æŸ¥æ˜¯å¦æœ‰ä¿å­˜çš„ç®¡ç†å‘˜è´¦å·
                const savedAdmin = JSON.parse(localStorage.getItem('adminCredentials'));
                if (savedAdmin) {
                    adminUsername.value = savedAdmin.username;
                    adminPassword.value = savedAdmin.password;
                    rememberAdmin.checked = true;
                }
                
                // æ£€æŸ¥æ˜¯å¦æœ‰ä¿å­˜çš„å¡å¯†
                const savedCardKey = localStorage.getItem('userCardKey');
                if (savedCardKey) {
                    cardKey.value = savedCardKey;
                    rememberUser.checked = true;
                }
            } catch (error) {
                console.error('è¯»å–ä¿å­˜çš„ç™»å½•ä¿¡æ¯å¤±è´¥:', error);
            }
            const inputText = document.getElementById('input-text');
            // è·å–é¢„è§ˆå®¹å™¨å…ƒç´ ï¼Œæ³¨æ„æ‰‹æœºå’Œç”µè„‘é¢„è§ˆéƒ½ä½¿ç”¨ç›¸åŒID
            const previewContent = document.querySelectorAll('#nice')[0];
            const mobilePreviewContent = document.querySelectorAll('#nice')[1];
            const htmlContent = document.getElementById('html-content');
            const toHtmlBtn = document.getElementById('to-html-btn');
            const toMarkdownBtn = document.getElementById('to-markdown-btn');
            const copyHtmlBtn = document.getElementById('copy-html-btn');
            const copyPreviewBtn = document.getElementById('copy-preview-btn');
            const previewTab = document.getElementById('preview-tab');
            const htmlTab = document.getElementById('html-tab');
            const clearBtn = document.getElementById('clear-btn');
            const importBtn = document.getElementById('import-btn');
            const fileInput = document.getElementById('file-input');
            // è·å–æ¨¡æ¿æŒ‰é’®å’Œæ–‡ä»¶è¾“å…¥å…ƒç´ 
            const uploadTopBtn = document.getElementById('upload-top-btn');
            const uploadH2Btn = document.getElementById('upload-h2-btn');
            const uploadBottomBtn = document.getElementById('upload-bottom-btn');
            const topFileInput = document.getElementById('top-file-input');
            const h2FileInput = document.getElementById('h2-file-input');
            const bottomFileInput = document.getElementById('bottom-file-input');
            const applyTopBtn = document.getElementById('apply-top-btn');
            const applyH2Btn = document.getElementById('apply-h2-btn');
            const applyBottomBtn = document.getElementById('apply-bottom-btn');
            const topFileName = document.getElementById('top-file-name');
            const h2FileName = document.getElementById('h2-file-name');
            const bottomFileName = document.getElementById('bottom-file-name');
            
            // è®¾ç½® marked é€‰é¡¹
            marked.setOptions({
                breaks: true,
                gfm: true,
                headerIds: true
            });
            
            // é¢„è§ˆæ¨¡å¼ç›¸å…³å…ƒç´ 
            const pcPreviewBtn = document.getElementById('pc-preview-btn');
            const mobilePreviewBtn = document.getElementById('mobile-preview-btn');
            const mobileContainer = document.getElementById('mobile-container');
            
            // å½“å‰é¢„è§ˆæ¨¡å¼ï¼ˆé»˜è®¤ä¸ºPCï¼‰
            let currentPreviewMode = 'pc';
            
            // è½¬æ¢ä¸º HTML å‡½æ•° - åªæ›´æ–°é¢„è§ˆï¼Œä¸æ”¹å˜è¾“å…¥å†…å®¹
            function convertToHtml() {
                try {
                    // æ£€æŸ¥è¾“å…¥æ˜¯å¦ä¸ºç©º
                    if (!inputText.value.trim()) {
                        alert('è¯·å…ˆè¾“å…¥å†…å®¹å†è¿›è¡Œè½¬æ¢');
                        return;
                    }
                    
                    const markdown = inputText.value;
                    const html = marked.parse(markdown);
                    
                    // åªæ›´æ–°é¢„è§ˆå†…å®¹ï¼Œä¸æ”¹å˜è¾“å…¥æ¡†å†…å®¹
                    previewContent.innerHTML = html;
                    mobilePreviewContent.innerHTML = html;
                    htmlContent.value = html;
                    showPreviewTab();
                    
                    // æ˜¾ç¤ºæˆåŠŸæ¶ˆæ¯
                    showOperationMessage(toHtmlBtn, 'å·²è½¬æ¢');
                } catch (error) {
                    console.error('è½¬æ¢ä¸º HTML æ—¶å‡ºé”™:', error);
                    const errorMsg = `<div class="text-red-500">è½¬æ¢ä¸º HTML æ—¶å‡ºé”™: ${error.message}</div>`;
                    previewContent.innerHTML = errorMsg;
                    mobilePreviewContent.innerHTML = errorMsg;
                    alert('è½¬æ¢å¤±è´¥: ' + error.message);
                }
            }
            
            // åŸºæœ¬çš„ HTML è½¬ Markdown è½¬æ¢ - åªæ›´æ–°é¢„è§ˆï¼Œä¸æ”¹å˜è¾“å…¥å†…å®¹
            function convertToMarkdown() {
                try {
                    // æ£€æŸ¥è¾“å…¥æ˜¯å¦ä¸ºç©º
                    if (!inputText.value.trim()) {
                        alert('è¯·å…ˆè¾“å…¥å†…å®¹å†è¿›è¡Œè½¬æ¢');
                        return;
                    }
                    
                    // è·å–è¾“å…¥çš„HTMLå†…å®¹
                    let htmlContent = inputText.value;
                    // è¿™æ˜¯ä¸€ä¸ªéå¸¸åŸºç¡€çš„ HTML åˆ° Markdown è½¬æ¢å™¨
                    // åœ¨å®é™…åº”ç”¨ä¸­ï¼Œåº”è¯¥ä½¿ç”¨åƒ turndown.js è¿™æ ·çš„åº“
                    // å…ˆå¤„ç†å›¾ç‰‡æ ‡ç­¾ï¼Œç¡®ä¿èƒ½æ•è·åˆ°æ‰€æœ‰å›¾ç‰‡
                    // æŸ¥æ‰¾æ‰€æœ‰imgæ ‡ç­¾å¹¶æå–srcå’Œaltå±æ€§
                    const imgTags = htmlContent.match(/<img[^>]*>/gi) || [];
                    let imageMap = [];
                    
                    // ä¿å­˜æ‰€æœ‰å›¾ç‰‡ä¿¡æ¯
                    for (let i = 0; i < imgTags.length; i++) {
                        const imgTag = imgTags[i];
                        const srcMatch = imgTag.match(/src=["'](.*?)["']/i);
                        const altMatch = imgTag.match(/alt=["'](.*?)["']/i);
                        
                        if (srcMatch && srcMatch[1]) {
                            const src = srcMatch[1];
                            const alt = (altMatch && altMatch[1]) ? altMatch[1] : `å›¾ç‰‡${i+1}`;
                            const placeholder = `IMG_PLACEHOLDER_${i}`;
                            
                            // æ›¿æ¢åŸå§‹HTMLä¸­çš„å›¾ç‰‡æ ‡ç­¾ä¸ºå ä½ç¬¦
                            htmlContent = htmlContent.replace(imgTag, placeholder);
                            
                            // ä¿å­˜å›¾ç‰‡ä¿¡æ¯
                            imageMap.push({
                                placeholder: placeholder,
                                markdown: `![${alt}](${src})`
                            });
                        }
                    }
                    
                    // å¸¸è§„HTMLè½¬Markdownå¤„ç†
                    let markdown = htmlContent
                        .replace(/<h1[^>]*>(.*?)<\/h1>/gi, '# $1\n\n')
                        .replace(/<h2[^>]*>(.*?)<\/h2>/gi, '## $1\n\n')
                        .replace(/<h3[^>]*>(.*?)<\/h3>/gi, '### $1\n\n')
                        .replace(/<h4[^>]*>(.*?)<\/h4>/gi, '#### $1\n\n')
                        .replace(/<h5[^>]*>(.*?)<\/h5>/gi, '##### $1\n\n')
                        .replace(/<h6[^>]*>(.*?)<\/h6>/gi, '###### $1\n\n')
                        .replace(/<p[^>]*>(.*?)<\/p>/gi, '$1\n\n')
                        .replace(/<strong[^>]*>(.*?)<\/strong>/gi, '**$1**')
                        .replace(/<b[^>]*>(.*?)<\/b>/gi, '**$1**')
                        .replace(/<em[^>]*>(.*?)<\/em>/gi, '*$1*')
                        .replace(/<i[^>]*>(.*?)<\/i>/gi, '*$1*')
                        .replace(/<a[^>]*href="(.*?)"[^>]*>(.*?)<\/a>/gi, '[$2]($1)')
                        .replace(/<ul[^>]*>(.*?)<\/ul>/gis, '$1\n')
                        .replace(/<ol[^>]*>(.*?)<\/ol>/gis, '$1\n')
                        .replace(/<li[^>]*>(.*?)<\/li>/gi, '- $1\n')
                        .replace(/<code[^>]*>(.*?)<\/code>/gi, '`$1`')
                        .replace(/<pre[^>]*><code[^>]*>(.*?)<\/code><\/pre>/gis, '```\n$1\n```\n\n')
                        .replace(/<blockquote[^>]*>(.*?)<\/blockquote>/gis, '> $1\n\n')
                        .replace(/<hr[^>]*>/gi, '---\n\n')
                        .replace(/<br[^>]*>/gi, '\n')
                        .replace(/&nbsp;/g, ' ')
                        .replace(/&lt;/g, '<')
                        .replace(/&gt;/g, '>')
                        .replace(/&amp;/g, '&');
                    
                    // æ›¿æ¢å›¾ç‰‡å ä½ç¬¦ä¸ºMarkdownå›¾ç‰‡è¯­æ³•
                    imageMap.forEach(img => {
                        markdown = markdown.replace(img.placeholder, img.markdown);
                    });
                        
                    // ç§»é™¤å‰©ä½™çš„ HTML æ ‡ç­¾
                    markdown = markdown.replace(/<[^>]*>/g, '');
                    
                    // ä¿®å¤å¤šä¸ªæ¢è¡Œ
                    markdown = markdown.replace(/\n\s*\n\s*\n/g, '\n\n');
                    
                    // ç”Ÿæˆé¢„è§ˆHTMLï¼ˆç›´æ¥ä»Markdownè€Œä¸æ˜¯åŸå§‹è¾“å…¥ï¼‰
                    const convertedHtml = marked.parse(markdown);
                    
                    // åªæ›´æ–°é¢„è§ˆï¼Œä¸æ”¹å˜è¾“å…¥å†…å®¹
                    previewContent.innerHTML = convertedHtml;
                    mobilePreviewContent.innerHTML = convertedHtml;
                    htmlContent.value = convertedHtml;
                    showPreviewTab();
                    
                    // æ˜¾ç¤ºæˆåŠŸæ¶ˆæ¯
                    showOperationMessage(toMarkdownBtn, 'å·²è½¬æ¢');
                } catch (error) {
                    console.error('è½¬æ¢ä¸º Markdown æ—¶å‡ºé”™:', error);
                    const errorMsg = `<div class="text-red-500">è½¬æ¢ä¸º Markdown æ—¶å‡ºé”™: ${error.message}</div>`;
                    previewContent.innerHTML = errorMsg;
                    mobilePreviewContent.innerHTML = errorMsg;
                    alert('è½¬æ¢å¤±è´¥: ' + error.message);
                }
            }
            
            // åˆ‡æ¢é¢„è§ˆæ¨¡å¼å‡½æ•°
            function switchPreviewMode(mode) {
                currentPreviewMode = mode;
                
                if (mode === 'pc') {
                    // åˆ‡æ¢åˆ°ç”µè„‘é¢„è§ˆæ¨¡å¼
                    previewContent.classList.remove('hidden');
                    mobileContainer.classList.add('hidden');
                    
                    // æ›´æ–°æŒ‰é’®æ ·å¼
                    pcPreviewBtn.classList.add('bg-primary', 'text-white');
                    pcPreviewBtn.classList.remove('bg-gray-300', 'dark:bg-gray-700', 'text-gray-800', 'dark:text-gray-200');
                    mobilePreviewBtn.classList.add('bg-gray-300', 'dark:bg-gray-700', 'text-gray-800', 'dark:text-gray-200');
                    mobilePreviewBtn.classList.remove('bg-primary', 'text-white');
                } else if (mode === 'mobile') {
                    // åˆ‡æ¢åˆ°æ‰‹æœºé¢„è§ˆæ¨¡å¼
                    previewContent.classList.add('hidden');
                    mobileContainer.classList.remove('hidden');
                    
                    // æ›´æ–°æŒ‰é’®æ ·å¼
                    mobilePreviewBtn.classList.add('bg-primary', 'text-white');
                    mobilePreviewBtn.classList.remove('bg-gray-300', 'dark:bg-gray-700', 'text-gray-800', 'dark:text-gray-200');
                    pcPreviewBtn.classList.add('bg-gray-300', 'dark:bg-gray-700', 'text-gray-800', 'dark:text-gray-200');
                    pcPreviewBtn.classList.remove('bg-primary', 'text-white');
                }
            }
            
            // è·å–CSSç›¸å…³å…ƒç´ 
            const cssTab = document.getElementById('css-tab');
            const cssContainer = document.getElementById('css-container');
            const customCssEditor = document.getElementById('custom-css');
            const applyCssBtn = document.getElementById('apply-css-btn');
            const saveCssBtn = document.getElementById('save-css-btn');
            const resetCssBtn = document.getElementById('reset-css-btn');
            
            // å­˜å‚¨è‡ªå®šä¹‰CSSçš„æ ·å¼å…ƒç´ 
            let customStyleElement = null;
            
            // æ ‡ç­¾åˆ‡æ¢å‡½æ•°
            function showPreviewTab() {
                // éšè—å…¶ä»–å†…å®¹
                htmlContent.classList.add('hidden');
                
                // éšè—CSSé¢æ¿
                const cssContainer = document.getElementById('css-container');
                cssContainer.classList.add('hidden');
                const cssBtn = document.getElementById('css-btn');
                cssBtn.classList.remove('bg-primary', 'text-white');
                cssBtn.classList.add('bg-gray-300', 'dark:bg-gray-700', 'text-gray-800', 'dark:text-gray-200');
                
                // æ ¹æ®å½“å‰é¢„è§ˆæ¨¡å¼é€‰æ‹©æ˜¾ç¤ºç”µè„‘æˆ–æ‰‹æœºé¢„è§ˆ
                if (currentPreviewMode === 'pc') {
                    previewContent.classList.remove('hidden');
                    mobileContainer.classList.add('hidden');
                } else {
                    previewContent.classList.add('hidden');
                    mobileContainer.classList.remove('hidden');
                }
                
                // æ›´æ–°æ ‡ç­¾æŒ‰é’®æ ·å¼
                previewTab.classList.add('bg-primary', 'text-white');
                previewTab.classList.remove('bg-gray-300', 'dark:bg-gray-700', 'text-gray-800', 'dark:text-gray-200');
                htmlTab.classList.add('bg-gray-300', 'dark:bg-gray-700', 'text-gray-800', 'dark:text-gray-200');
                htmlTab.classList.remove('bg-primary', 'text-white');
            }
            
            function showHtmlTab() {
                // éšè—æ‰€æœ‰å…¶ä»–å†…å®¹
                previewContent.classList.add('hidden');
                mobileContainer.classList.add('hidden');
                
                // éšè—CSSé¢æ¿
                const cssContainer = document.getElementById('css-container');
                cssContainer.classList.add('hidden');
                const cssBtn = document.getElementById('css-btn');
                cssBtn.classList.remove('bg-primary', 'text-white');
                cssBtn.classList.add('bg-gray-300', 'dark:bg-gray-700', 'text-gray-800', 'dark:text-gray-200');
                
                // æ˜¾ç¤ºHTMLå†…å®¹
                htmlContent.classList.remove('hidden');
                
                // æ›´æ–°æ ‡ç­¾æŒ‰é’®æ ·å¼
                htmlTab.classList.add('bg-primary', 'text-white');
                htmlTab.classList.remove('bg-gray-300', 'dark:bg-gray-700', 'text-gray-800', 'dark:text-gray-200');
                previewTab.classList.add('bg-gray-300', 'dark:bg-gray-700', 'text-gray-800', 'dark:text-gray-200');
                previewTab.classList.remove('bg-primary', 'text-white');
            }
            
            // åº”ç”¨è‡ªå®šä¹‰CSSæ ·å¼
            function applyCustomCss() {
                const css = customCssEditor.value;
                
                // ç§»é™¤ä¹‹å‰çš„è‡ªå®šä¹‰æ ·å¼
                if (customStyleElement) {
                    document.head.removeChild(customStyleElement);
                }
                
                // åˆ›å»ºæ–°çš„æ ·å¼å…ƒç´ 
                if (css.trim()) {
                    // å¤„ç†CSSä»£ç ï¼Œæ›¿æ¢#niceé€‰æ‹©å™¨
                    const processedCss = processNiceSelectors(css);
                    
                    customStyleElement = document.createElement('style');
                    customStyleElement.id = 'custom-user-css';
                    customStyleElement.textContent = processedCss;
                    document.head.appendChild(customStyleElement);
                    
                    // æ·»åŠ è¾…åŠ©æ ·å¼ï¼Œç¡®ä¿é¢„è§ˆåŒºåŸŸæœ‰åˆé€‚çš„å¤§å°å’Œè¾¹è·
                    const helperStyles = document.createElement('style');
                    helperStyles.textContent = `
                        .preview-content {
                            padding: 30px !important;
                            font-family: PingFangSC-Light !important;
                            word-break: break-all !important;
                        }
                    `;
                    document.head.appendChild(helperStyles);
                }
                
                // æ˜¾ç¤ºæˆåŠŸæ¶ˆæ¯
                showOperationMessage(applyCssBtn, 'å·²åº”ç”¨');
                
                // æ·»åŠ ç¤ºä¾‹CSSåˆ°å ä½ç¬¦
                if (customCssEditor.value === '') {
                    customCssEditor.setAttribute('placeholder', `/* ç¤ºä¾‹CSS:
#nice {
    font-family: PingFangSC-Light;
    padding: 30px;
    word-break: break-all;
}

#nice p:nth-of-type(3n+1) {
    color: #ab089f;
    margin: 10px 10px;
    line-height: 1.75;
    letter-spacing: 0.2em;
    font-size: 14px;
}

#nice h1 {
    border-bottom: 2px solid #7c8962;
    font-size: 1.3em;
    text-align: center;
    margin: 20px 0;
}
*/`);
                }
            }
            
            // å¤„ç†CSSä¸­çš„#niceé€‰æ‹©å™¨ï¼Œè½¬æ¢ä¸ºé€‚é…æˆ‘ä»¬é¢„è§ˆå®¹å™¨çš„é€‰æ‹©å™¨
            function processNiceSelectors(css) {
                // åŒ¹é…æ‰€æœ‰å¯èƒ½çš„#niceé€‰æ‹©å™¨æ¨¡å¼
                const niceRegexes = [
                    { 
                        // åŒ¹é…"#nice"å¼€å¤´çš„é€‰æ‹©å™¨
                        pattern: /#nice(?=\s*[,{])/g, 
                        replacement: '.preview-content' 
                    },
                    { 
                        // åŒ¹é…"#nice."å¼€å¤´çš„é€‰æ‹©å™¨
                        pattern: /#nice\.([a-zA-Z0-9_-]+)/g, 
                        replacement: '.preview-content.$1' 
                    },
                    { 
                        // åŒ¹é…"#nice "å¼€å¤´çš„é€‰æ‹©å™¨ (åŒ…å«å­é€‰æ‹©å™¨)
                        pattern: /#nice\s+([\.#a-zA-Z0-9_-])/g, 
                        replacement: '.preview-content $1' 
                    },
                    { 
                        // åŒ¹é…"#nice:"å¼€å¤´çš„ä¼ªé€‰æ‹©å™¨
                        pattern: /#nice:([a-zA-Z0-9_-]+)/g, 
                        replacement: '.preview-content:$1' 
                    },
                    { 
                        // åŒ¹é…"#nice["å¼€å¤´çš„å±æ€§é€‰æ‹©å™¨
                        pattern: /#nice\[([^\]]+)\]/g, 
                        replacement: '.preview-content[$1]' 
                    }
                ];
                
                // åº”ç”¨æ‰€æœ‰å¯èƒ½çš„æ›¿æ¢
                let processedCss = css;
                niceRegexes.forEach(regex => {
                    processedCss = processedCss.replace(regex.pattern, regex.replacement);
                });
                
                return processedCss;
            }
            
            // å†…å­˜ä¸­å­˜å‚¨CSS
            let savedCssInMemory = '';
            
            // ä¿å­˜CSSåˆ°å†…å­˜
            function saveCustomCss() {
                try {
                    // åªä¿å­˜åœ¨å†…å­˜ä¸­
                    savedCssInMemory = customCssEditor.value;
                    showOperationMessage(saveCssBtn, 'å·²ä¿å­˜');
                } catch (error) {
                    console.error('ä¿å­˜CSSå¤±è´¥:', error);
                    alert('ä¿å­˜CSSå¤±è´¥');
                }
            }
            
            // é‡ç½®CSSæ ·å¼
            function resetCustomCss() {
                // ç¡®è®¤æ˜¯å¦è¦é‡ç½®
                if (confirm('ç¡®å®šè¦é‡ç½®è‡ªå®šä¹‰CSSæ ·å¼å—ï¼Ÿè¿™å°†åˆ é™¤æ‰€æœ‰è‡ªå®šä¹‰æ ·å¼ã€‚')) {
                    // æ¸…ç©ºç¼–è¾‘å™¨
                    customCssEditor.value = '';
                    
                    // ç§»é™¤åº”ç”¨çš„æ ·å¼
                    if (customStyleElement) {
                        document.head.removeChild(customStyleElement);
                        customStyleElement = null;
                    }
                    
                    // æ¸…ç©ºå†…å­˜ä¸­çš„CSS
                    savedCssInMemory = '';
                    
                    // æ˜¾ç¤ºæˆåŠŸæ¶ˆæ¯
                    showOperationMessage(resetCssBtn, 'å·²é‡ç½®');
                }
            }
            
            // åŠ è½½ä¿å­˜çš„CSS
            function loadSavedCss() {
                // ä½¿ç”¨å†…å­˜ä¸­çš„CSS
                if (savedCssInMemory) {
                    customCssEditor.value = savedCssInMemory;
                    applyCustomCss();
                }
            }
            
            // å¤åˆ¶å‡½æ•°
            async function copyToClipboard(text) {
                try {
                    await navigator.clipboard.writeText(text);
                    return true;
                } catch (err) {
                    console.error('å¤åˆ¶å¤±è´¥: ', err);
                    return false;
                }
            }
            
            // ç»Ÿä¸€æ˜¾ç¤ºæ“ä½œæ¶ˆæ¯çš„å‡½æ•°
            function showOperationMessage(button, message) {
                const originalText = button.textContent;
                const originalBgColor = button.classList.contains('bg-primary') ? 'bg-primary' : 'bg-gray-500';
                button.textContent = `âœ“ ${message}`;
                button.classList.remove(originalBgColor);
                button.classList.add('bg-green-600');
                
                setTimeout(() => {
                    button.textContent = originalText;
                    button.classList.remove('bg-green-600');
                    button.classList.add(originalBgColor);
                }, 2000);
            }
            
            function showCopiedMessage(button, originalText) {
                showOperationMessage(button, 'å·²å¤åˆ¶!');
            }
            
            // è·å–æ–‡ä»¶åæ˜¾ç¤ºå…ƒç´ 
            const currentFileName = document.getElementById('current-file-name');
            
            // å¯¼å…¥æ–‡ä»¶å‡½æ•°
            function handleFileImport(event) {
                const file = event.target.files[0];
                if (!file) return;
                
                // æ˜¾ç¤ºæ–‡ä»¶å - ä¸å¸¦åç¼€
                const fileName = file.name.lastIndexOf('.') !== -1 ? 
                    file.name.substring(0, file.name.lastIndexOf('.')) : file.name;
                currentFileName.textContent = `å½“å‰æ–‡ä»¶: ${fileName}`;
                currentFileName.classList.remove('hidden');
                
                const reader = new FileReader();
                reader.onload = function(e) {
                    inputText.value = e.target.result;
                    if (file.name.endsWith('.md') || file.name.endsWith('.markdown')) {
                        convertToHtml();
                    } else if (file.name.endsWith('.html')) {
                        // å¯¹äº HTML æ–‡ä»¶ï¼Œç›´æ¥åœ¨é¢„è§ˆä¸­æ˜¾ç¤º
                        previewContent.innerHTML = e.target.result;
                        htmlContent.value = e.target.result;
                        showPreviewTab();
                    } else {
                        // å¯¹äºå…¶ä»–æ–‡ä»¶ï¼Œå½“ä½œ markdown å¤„ç†
                        convertToHtml();
                    }
                };
                reader.readAsText(file);
            }
            
            // åŠ è½½æ¨¡æ¿

            
            // CSSç›¸å…³äº‹ä»¶ç›‘å¬å™¨
            const cssBtn = document.getElementById('css-btn');
            const toggleCssEditorBtn = document.getElementById('toggle-css-editor');
            const toggleIcon = document.getElementById('toggle-icon');
            const cssEditorContainer = document.getElementById('css-editor-container');
            
            cssBtn.addEventListener('click', toggleCssPanel);
            applyCssBtn.addEventListener('click', applyCustomCss);
            saveCssBtn.addEventListener('click', saveCustomCss);
            resetCssBtn.addEventListener('click', resetCustomCss);
            toggleCssEditorBtn.addEventListener('click', toggleCssEditor);
            
            // CSSç¼–è¾‘å™¨çš„æŠ˜å /å±•å¼€çŠ¶æ€
            let cssEditorExpanded = true;
            
            // åˆ‡æ¢CSSç¼–è¾‘å™¨çš„æŠ˜å /å±•å¼€çŠ¶æ€
            function toggleCssEditor() {
                cssEditorExpanded = !cssEditorExpanded;
                
                if (cssEditorExpanded) {
                    // å±•å¼€ç¼–è¾‘å™¨
                    cssEditorContainer.style.display = 'block';
                    toggleIcon.textContent = 'ğŸ“•'; // å…³é—­å›¾æ ‡
                } else {
                    // æŠ˜å ç¼–è¾‘å™¨
                    cssEditorContainer.style.display = 'none';
                    toggleIcon.textContent = 'ğŸ“–'; // æ‰“å¼€å›¾æ ‡
                }
            }
            
            // åˆ‡æ¢CSSé¢æ¿çš„æ˜¾ç¤º/éšè—
            function toggleCssPanel() {
                const cssContainer = document.getElementById('css-container');
                
                if (cssContainer.classList.contains('hidden')) {
                    // æ˜¾ç¤ºCSSé¢æ¿
                    cssContainer.classList.remove('hidden');
                    cssBtn.classList.add('bg-primary', 'text-white');
                    cssBtn.classList.remove('bg-gray-300', 'dark:bg-gray-700', 'text-gray-800', 'dark:text-gray-200');
                } else {
                    // éšè—CSSé¢æ¿
                    cssContainer.classList.add('hidden');
                    cssBtn.classList.remove('bg-primary', 'text-white');
                    cssBtn.classList.add('bg-gray-300', 'dark:bg-gray-700', 'text-gray-800', 'dark:text-gray-200');
                }
            }
            
            // ä¸€èˆ¬äº‹ä»¶ç›‘å¬å™¨
            toHtmlBtn.addEventListener('click', convertToHtml);
            toMarkdownBtn.addEventListener('click', convertToMarkdown);
            previewTab.addEventListener('click', showPreviewTab);
            htmlTab.addEventListener('click', showHtmlTab);
            clearBtn.addEventListener('click', () => {
                // æ¸…ç©ºå†…å®¹
                inputText.value = '';
                previewContent.innerHTML = '';
                htmlContent.value = '';
                
                // éšè—æ–‡ä»¶åæ˜¾ç¤º
                currentFileName.textContent = '';
                currentFileName.classList.add('hidden');
            });
            
            importBtn.addEventListener('click', () => {
                fileInput.click();
            });
            
            fileInput.addEventListener('change', handleFileImport);
            
            copyHtmlBtn.addEventListener('click', async () => {
                const success = await copyToClipboard(htmlContent.value);
                if (success) {
                    showCopiedMessage(copyHtmlBtn, 'å¤åˆ¶ HTML');
                }
            });
            
            copyPreviewBtn.addEventListener('click', () => {
                // ä¿å­˜ç”¨æˆ·å½“å‰çš„é€‰æ‹©
                const userSelection = window.getSelection();
                const currentRange = userSelection.rangeCount > 0 ? userSelection.getRangeAt(0) : null;
                
                // æ¸…é™¤å½“å‰é€‰æ‹©
                userSelection.removeAllRanges();
                
                // åˆ›å»ºä¸€ä¸ªé€‰æ‹©æ•´ä¸ªé¢„è§ˆå†…å®¹çš„èŒƒå›´
                const range = document.createRange();
                range.selectNodeContents(previewContent);
                userSelection.addRange(range);
                
                // æ‰§è¡Œå¤åˆ¶å‘½ä»¤
                let success = false;
                try {
                    success = document.execCommand('copy');
                } catch (err) {
                    console.error('å¤åˆ¶å¤±è´¥: ', err);
                }
                
                // æ¢å¤åŸæ¥çš„é€‰æ‹©
                userSelection.removeAllRanges();
                if (currentRange) {
                    userSelection.addRange(currentRange);
                }
                
                if (success) {
                    showCopiedMessage(copyPreviewBtn, 'å¤åˆ¶é¢„è§ˆå†…å®¹');
                }
            });
            
            // è·å–æ¨¡æ¿ä¸‹æ‹‰é€‰æ‹©å…ƒç´ 
            const topTemplateSelect = document.getElementById('top-template-select');
            const h2TemplateSelect = document.getElementById('h2-template-select');
            const bottomTemplateSelect = document.getElementById('bottom-template-select');
            const topFileCount = document.getElementById('top-file-count');
            const h2FileCount = document.getElementById('h2-file-count');
            const bottomFileCount = document.getElementById('bottom-file-count');
            
            // æ¨¡æ¿æ–‡ä»¶å­˜å‚¨å¯¹è±¡ - ä½¿ç”¨å†…å­˜å­˜å‚¨
            const templateCollections = {
                top: [],
                h2: [],
                bottom: []
            };
            
            // å¯¼å‡º/å¯¼å…¥ç›¸å…³å…ƒç´ 
            const exportAllBtn = document.getElementById('export-all-btn');
            const importAllBtn = document.getElementById('import-all-btn');
            
            // åˆ›å»ºä¸€ä¸ªéšè—çš„æ–‡ä»¶è¾“å…¥å…ƒç´ ï¼Œç”¨äºå¯¼å…¥è®¾ç½®
            const settingsFileInput = document.createElement('input');
            settingsFileInput.type = 'file';
            settingsFileInput.accept = '.json';
            settingsFileInput.style.display = 'none';
            document.body.appendChild(settingsFileInput);
            
            // å¯¼å‡ºæ‰€æœ‰è®¾ç½®å‡½æ•°
            function exportAllSettings() {
                try {
                    // æ”¶é›†æ‰€æœ‰æ¨¡æ¿å’ŒCSSæ ·å¼
                    const settings = {
                        version: '1.0',
                        timestamp: new Date().toISOString(),
                        templates: {
                            top: templateCollections.top,
                            h2: templateCollections.h2,
                            bottom: templateCollections.bottom
                        },
                        css: customCssEditor.value
                    };
                    
                    // è½¬æ¢ä¸ºJSONå¹¶åˆ›å»ºBlob
                    const settingsJson = JSON.stringify(settings, null, 2);
                    const blob = new Blob([settingsJson], { type: 'application/json' });
                    
                    // åˆ›å»ºä¸‹è½½é“¾æ¥
                    const url = URL.createObjectURL(blob);
                    const a = document.createElement('a');
                    a.href = url;
                    a.download = `markdown-settings-${new Date().toISOString().slice(0, 10)}.json`;
                    
                    // è§¦å‘ä¸‹è½½å¹¶æ¸…ç†
                    document.body.appendChild(a);
                    a.click();
                    document.body.removeChild(a);
                    URL.revokeObjectURL(url);
                    
                    // æ˜¾ç¤ºæˆåŠŸæ¶ˆæ¯
                    showOperationMessage(exportAllBtn, 'å·²å¯¼å‡º');
                } catch (error) {
                    console.error('å¯¼å‡ºè®¾ç½®å¤±è´¥:', error);
                    alert('å¯¼å‡ºè®¾ç½®å¤±è´¥: ' + error.message);
                }
            }
            
            // å¯¼å…¥è®¾ç½®å‡½æ•°
            function importSettings(event) {
                const file = event.target.files[0];
                if (!file) return;
                
                const reader = new FileReader();
                reader.onload = function(e) {
                    try {
                        const settings = JSON.parse(e.target.result);
                        
                        // éªŒè¯è®¾ç½®æ–‡ä»¶æ ¼å¼
                        if (!settings.templates || !settings.version) {
                            throw new Error('æ— æ•ˆçš„è®¾ç½®æ–‡ä»¶æ ¼å¼');
                        }
                        
                        // å¯¼å…¥æ¨¡æ¿
                        if (settings.templates.top) {
                            templateCollections.top = settings.templates.top;
                            updateTemplateUI('top', topTemplateSelect, topFileCount);
                        }
                        
                        if (settings.templates.h2) {
                            templateCollections.h2 = settings.templates.h2;
                            updateTemplateUI('h2', h2TemplateSelect, h2FileCount);
                        }
                        
                        if (settings.templates.bottom) {
                            templateCollections.bottom = settings.templates.bottom;
                            updateTemplateUI('bottom', bottomTemplateSelect, bottomFileCount);
                        }
                        
                        // å¯¼å…¥CSS
                        if (settings.css) {
                            customCssEditor.value = settings.css;
                            savedCssInMemory = settings.css;
                            applyCustomCss();
                        }
                        
                        // æ˜¾ç¤ºæˆåŠŸæ¶ˆæ¯
                        showOperationMessage(importAllBtn, 'å·²å¯¼å…¥');
                        
                        // æ˜¾ç¤ºå¯¼å…¥çš„å†…å®¹æ‘˜è¦
                        const topCount = settings.templates.top ? settings.templates.top.length : 0;
                        const h2Count = settings.templates.h2 ? settings.templates.h2.length : 0;
                        const bottomCount = settings.templates.bottom ? settings.templates.bottom.length : 0;
                        const hasCss = settings.css && settings.css.trim().length > 0;
                        
                        alert(`æˆåŠŸå¯¼å…¥è®¾ç½®:\n- ${topCount}ä¸ªå¤´éƒ¨æ¨¡æ¿\n- ${h2Count}ä¸ªå°æ ‡é¢˜æ¨¡æ¿\n- ${bottomCount}ä¸ªå°¾éƒ¨æ¨¡æ¿\n- CSSæ ·å¼: ${hasCss ? 'å·²å¯¼å…¥' : 'æ— '}`);
                        
                    } catch (error) {
                        console.error('å¯¼å…¥è®¾ç½®å¤±è´¥:', error);
                        alert('å¯¼å…¥è®¾ç½®å¤±è´¥: ' + error.message);
                    }
                };
                reader.readAsText(file);
            }
            
            // å¯¼å‡º/å¯¼å…¥æŒ‰é’®äº‹ä»¶ç›‘å¬
            exportAllBtn.addEventListener('click', exportAllSettings);
            importAllBtn.addEventListener('click', () => {
                settingsFileInput.click();
            });
            settingsFileInput.addEventListener('change', importSettings);
            
            // æ³¨æ„ï¼šç”±äºiframeæ²™ç›’é™åˆ¶ï¼Œæˆ‘ä»¬ä¸ä½¿ç”¨localStorageï¼Œæ”¹ä¸ºä¼šè¯å†…å­˜å‚¨
            function loadSavedTemplates() {
                // åœ¨æ²™ç›’ç¯å¢ƒä¸­æ— æ³•è®¿é—®localStorageï¼Œå› æ­¤ä¸åŠ è½½ä»»ä½•ä¿å­˜çš„æ¨¡æ¿
                // è¿™é‡Œå¯ä»¥æ·»åŠ æç¤ºä¿¡æ¯
                const infoMessage = document.createElement('div');
                infoMessage.className = 'text-xs text-primary mt-1 text-center';
                infoMessage.textContent = 'æç¤º: ä½¿ç”¨ä¸Šæ–¹çš„"å¯¼å‡ºæ‰€æœ‰è®¾ç½®"æŒ‰é’®ä¿å­˜æ‚¨çš„æ¨¡æ¿å’ŒCSSæ ·å¼ï¼Œä¸‹æ¬¡ä½¿ç”¨æ—¶å¯é€šè¿‡"å¯¼å…¥è®¾ç½®"æ¢å¤';
                document.querySelector('footer').before(infoMessage);
            }
            
            // ç”±äºæ²™ç›’é™åˆ¶ï¼Œæ­¤å‡½æ•°å®é™…ä¸Šä¸ä¼šä¿å­˜åˆ°localStorage
            // ä»…åœ¨å½“å‰ä¼šè¯ä¸­ä¿ç•™æ¨¡æ¿
            function saveTemplatesToLocalStorage() {
                // ä¸æ‰§è¡Œå®é™…çš„localStorageä¿å­˜æ“ä½œ
                // console.log('æ¨¡æ¿å·²æ›´æ–°ï¼Œä½†ä»…ä¿ç•™åœ¨å½“å‰ä¼šè¯ä¸­');
            }
            
            // æ›´æ–°æ¨¡æ¿UI
            function updateTemplateUI(templateType, selectElement, countElement) {
                const templates = templateCollections[templateType];
                
                // æ¸…ç©ºæ—§çš„ä¸‹æ‹‰é€‰é¡¹ï¼ˆä¿ç•™ç¬¬ä¸€ä¸ªé»˜è®¤é€‰é¡¹ï¼‰
                while (selectElement.options.length > 1) {
                    selectElement.remove(1);
                }
                
                // æ·»åŠ æ¨¡æ¿åˆ°ä¸‹æ‹‰é€‰é¡¹
                templates.forEach((template, index) => {
                    const option = document.createElement('option');
                    option.value = index;
                    option.textContent = template.name;
                    selectElement.appendChild(option);
                });
                
                // æ›´æ–°è®¡æ•°
                const fileCount = templates.length;
                countElement.textContent = `å·²ä¿å­˜: ${fileCount}ä¸ªæ¨¡æ¿`;
                
                if (fileCount > 0) {
                    countElement.classList.remove('text-gray-500', 'dark:text-gray-400');
                    countElement.classList.add('text-green-600', 'dark:text-green-400');
                    // è‡ªåŠ¨é€‰æ‹©ç¬¬ä¸€ä¸ªæ¨¡æ¿
                    selectElement.value = 0;
                } else {
                    countElement.classList.remove('text-green-600', 'dark:text-green-400');
                    countElement.classList.add('text-gray-500', 'dark:text-gray-400');
                }
            }
            
            // ä¸Šä¼ å¤šä¸ªæ¨¡æ¿æ–‡ä»¶å¤„ç†å‡½æ•°
            function handleTemplateUpload(event, templateType, countElement, selectElement) {
                const files = event.target.files;
                if (!files || files.length === 0) return;
                
                // æç¤ºç”¨æˆ·æ­£åœ¨å¤„ç†
                countElement.textContent = `å¤„ç†ä¸­...`;
                
                // ä½¿ç”¨ Promise.all å¤„ç†æ‰€æœ‰æ–‡ä»¶
                const promises = Array.from(files).map(file => {
                    return new Promise((resolve) => {
                        const reader = new FileReader();
                        reader.onload = function(e) {
                            // å°†æ–‡ä»¶å†…å®¹å’Œåç§°ä¿å­˜åˆ°é›†åˆä¸­
                            templateCollections[templateType].push({
                                name: file.name,
                                content: e.target.result
                            });
                            resolve();
                        };
                        reader.readAsText(file);
                    });
                });
                
                // æ‰€æœ‰æ–‡ä»¶å¤„ç†å®Œæˆåæ›´æ–°UI
                Promise.all(promises).then(() => {
                    // æ›´æ–°UI
                    updateTemplateUI(templateType, selectElement, countElement);
                    
                    // ä¿å­˜åˆ°localStorage
                    saveTemplatesToLocalStorage();
                });
            }
            
            // åº”ç”¨æ¨¡æ¿å‡½æ•°
            function applyTemplate(templateType) {
                const selectElement = document.getElementById(`${templateType}-template-select`);
                const selectedIndex = selectElement.value;
                
                if (!selectedIndex || selectedIndex === '') {
                    alert(`è¯·å…ˆé€‰æ‹©ä¸€ä¸ª${templateType === 'top' ? 'å¤´éƒ¨' : templateType === 'h2' ? 'å°æ ‡é¢˜' : 'å°¾éƒ¨'}æ¨¡æ¿`);
                    return;
                }
                
                // è·å–é€‰ä¸­çš„æ¨¡æ¿å†…å®¹
                const templateContent = templateCollections[templateType][selectedIndex].content;
                
                if (!templateContent || templateContent.trim() === '') {
                    alert(`æ‰€é€‰æ¨¡æ¿å†…å®¹ä¸ºç©º`);
                    return;
                }
                
                let currentContent = inputText.value;
                
                switch(templateType) {
                    case 'top':
                        // æ·»åŠ åˆ°æ–‡ç« å¼€å¤´
                        inputText.value = templateContent + '\n\n' + currentContent;
                        break;
                    case 'h2':
                        // è·å–å…‰æ ‡ä½ç½®
                        const cursorPos = inputText.selectionStart;
                        
                        // æŸ¥æ‰¾æœ€è¿‘çš„h2æ ‡é¢˜ä½ç½®
                        if (cursorPos !== undefined) {
                            // æŸ¥æ‰¾å½“å‰å…‰æ ‡å‰æœ€è¿‘çš„h2æ ‡ç­¾ - æ”¯æŒå„ç§æ ¼å¼çš„h2æ ‡é¢˜
                            // æ”¯æŒåŒ…å«æ˜Ÿå·å’Œå…¶ä»–æ ¼å¼çš„äºŒçº§æ ‡é¢˜
                            const contentBeforeCursor = currentContent.substring(0, cursorPos);
                            const h2Matches = [...contentBeforeCursor.matchAll(/^##\s+.*$/gm)];
                            
                            if (h2Matches.length > 0) {
                                // æ‰¾åˆ°æœ€åä¸€ä¸ªh2æ ‡ç­¾
                                const lastH2Match = h2Matches[h2Matches.length - 1];
                                const h2Index = lastH2Match.index;
                                const h2Line = lastH2Match[0];
                                
                                // æŸ¥æ‰¾h2æ‰€åœ¨è¡Œåçš„ç¬¬ä¸€ä¸ªæ–°æ®µè½
                                // è®¡ç®—h2è¡Œçš„æœ«å°¾ä½ç½®
                                const lineEndIndex = contentBeforeCursor.indexOf('\n', h2Index);
                                const lineEnd = lineEndIndex !== -1 ? lineEndIndex : cursorPos;
                                
                                // å¯»æ‰¾ä¸‹ä¸€ä¸ªæ®µè½çš„å¼€å§‹ä½ç½®
                                const contentAfterTitle = currentContent.substring(lineEnd);
                                // æ£€æŸ¥æ˜¯å¦å·²ç»æœ‰å†…å®¹åœ¨æ ‡é¢˜ä¸‹
                                const nextBlockMatch = contentAfterTitle.match(/^\n+([^\n]+)/);
                                let insertionPoint;
                                
                                if (nextBlockMatch) {
                                    // æ‰¾åˆ°æ ‡é¢˜ä¸‹çš„ç¬¬ä¸€ä¸ªå†…å®¹å—çš„æœ«å°¾ï¼Œåœ¨é‚£é‡Œæ’å…¥æ¨¡æ¿
                                    const firstBlockEnd = lineEnd + nextBlockMatch[0].length;
                                    insertionPoint = firstBlockEnd;
                                } else {
                                    // å¦‚æœæ ‡é¢˜ä¸‹æ²¡æœ‰å†…å®¹ï¼Œç›´æ¥åœ¨æ ‡é¢˜ä¹‹åæ’å…¥
                                    insertionPoint = lineEnd;
                                }
                                
                                // åœ¨h2æ ‡é¢˜ä¹‹åæ’å…¥æ¨¡æ¿
                                inputText.value = 
                                    currentContent.substring(0, insertionPoint) + 
                                    '\n\n' + templateContent + 
                                    (insertionPoint < currentContent.length ? '\n' + currentContent.substring(insertionPoint) : '');
                                
                                // æ˜¾ç¤ºæˆåŠŸæç¤º
                                alert(`å·²å°†å°æ ‡é¢˜æ¨¡æ¿åº”ç”¨åˆ°"${h2Line.trim()}"ä¹‹å`);
                                
                                // è½¬æ¢å¹¶æ˜¾ç¤ºé¢„è§ˆ
                                convertToHtml();
                                
                                // æ˜¾ç¤ºæ“ä½œæˆåŠŸæ¶ˆæ¯
                                const applyBtn = document.getElementById(`apply-h2-btn`);
                                showOperationMessage(applyBtn, 'å·²åº”ç”¨');
                                return; // æå‰è¿”å›ï¼Œä¸æ‰§è¡Œåé¢çš„ä»£ç 
                            }
                        }
                        
                        // å¦‚æœæ²¡æœ‰æ‰¾åˆ°h2æ ‡ç­¾æˆ–æ²¡æœ‰é€‰ä¸­ä½ç½®ï¼Œè¯¢é—®ç”¨æˆ·
                        if (confirm('æ²¡æœ‰æ‰¾åˆ°å…‰æ ‡é™„è¿‘çš„äºŒçº§æ ‡é¢˜(##)ã€‚æ˜¯å¦è¦å…ˆæ·»åŠ ä¸€ä¸ªäºŒçº§æ ‡é¢˜ï¼Œå†åº”ç”¨æ­¤æ¨¡æ¿ï¼Ÿ')) {
                            // è®©ç”¨æˆ·è¾“å…¥æ ‡é¢˜æ–‡æœ¬
                            const titleText = prompt('è¯·è¾“å…¥äºŒçº§æ ‡é¢˜å†…å®¹ï¼š');
                            if (titleText) {
                                // æ·»åŠ æ ‡é¢˜å’Œæ¨¡æ¿
                                const h2Title = `## ${titleText}`;
                                
                                // åœ¨å…‰æ ‡ä½ç½®æˆ–æ–‡æ¡£æœ«å°¾æ·»åŠ 
                                if (cursorPos !== undefined) {
                                    inputText.value = 
                                        currentContent.substring(0, cursorPos) + 
                                        h2Title + '\n\n' + 
                                        templateContent + '\n\n' + 
                                        currentContent.substring(cursorPos);
                                } else {
                                    inputText.value = 
                                        currentContent + '\n\n' + 
                                        h2Title + '\n\n' + 
                                        templateContent;
                                }
                            }
                        } else {
                            // ç”¨æˆ·é€‰æ‹©ä¸æ·»åŠ æ ‡é¢˜ï¼Œç›´æ¥åœ¨å…‰æ ‡ä½ç½®æ·»åŠ æ¨¡æ¿
                            if (cursorPos !== undefined) {
                                inputText.value = 
                                    currentContent.substring(0, cursorPos) + 
                                    '\n\n' + templateContent + '\n\n' + 
                                    currentContent.substring(cursorPos);
                            } else {
                                // å¦‚æœæ²¡æœ‰å…‰æ ‡ä½ç½®ï¼Œæ·»åŠ åˆ°æœ«å°¾
                                inputText.value = currentContent + '\n\n' + templateContent;
                            }
                        }
                        break;
                    case 'bottom':
                        // æ·»åŠ åˆ°æ–‡ç« æœ«å°¾
                        inputText.value = currentContent + '\n\n' + templateContent;
                        break;
                }
                
                // è½¬æ¢å¹¶æ˜¾ç¤ºé¢„è§ˆ
                convertToHtml();
                
                // æ˜¾ç¤ºæ“ä½œæˆåŠŸæ¶ˆæ¯
                const applyBtn = document.getElementById(`apply-${templateType}-btn`);
                showOperationMessage(applyBtn, 'å·²åº”ç”¨');
            }
            
            // ä¸Šä¼ å¤´éƒ¨æ¨¡æ¿äº‹ä»¶ç›‘å¬
            uploadTopBtn.addEventListener('click', () => {
                topFileInput.click();
            });
            
            topFileInput.addEventListener('change', (event) => {
                handleTemplateUpload(event, 'top', topFileCount, topTemplateSelect);
            });
            
            // ä¸Šä¼ å°æ ‡é¢˜æ¨¡æ¿äº‹ä»¶ç›‘å¬
            uploadH2Btn.addEventListener('click', () => {
                h2FileInput.click();
            });
            
            h2FileInput.addEventListener('change', (event) => {
                handleTemplateUpload(event, 'h2', h2FileCount, h2TemplateSelect);
            });
            
            // ä¸Šä¼ å°¾éƒ¨æ¨¡æ¿äº‹ä»¶ç›‘å¬
            uploadBottomBtn.addEventListener('click', () => {
                bottomFileInput.click();
            });
            
            bottomFileInput.addEventListener('change', (event) => {
                handleTemplateUpload(event, 'bottom', bottomFileCount, bottomTemplateSelect);
            });
            
            // åº”ç”¨æ¨¡æ¿äº‹ä»¶ç›‘å¬
            applyTopBtn.addEventListener('click', () => {
                applyTemplate('top');
            });
            
            applyH2Btn.addEventListener('click', () => {
                applyTemplate('h2');
            });
            
            applyBottomBtn.addEventListener('click', () => {
                applyTemplate('bottom');
            });
            
            // æ·»åŠ ç”µè„‘å’Œæ‰‹æœºé¢„è§ˆæ¨¡å¼åˆ‡æ¢äº‹ä»¶ç›‘å¬
            pcPreviewBtn.addEventListener('click', () => {
                switchPreviewMode('pc');
            });
            
            mobilePreviewBtn.addEventListener('click', () => {
                switchPreviewMode('mobile');
            });
            
            // åˆå§‹åŒ–ä¸ºç”µè„‘é¢„è§ˆæ¨¡å¼
            switchPreviewMode('pc');
            
            // ç”¨æˆ·è¾“å…¥æ—¶è‡ªåŠ¨è½¬æ¢ï¼ˆå¸¦é˜²æŠ–ï¼‰
            let debounceTimer;
            inputText.addEventListener('input', () => {
                clearTimeout(debounceTimer);
                debounceTimer = setTimeout(convertToHtml, 500);
            });
            
            // æ·»åŠ å¯†ç æ˜¾ç¤º/éšè—åˆ‡æ¢åŠŸèƒ½
            const togglePasswordButtons = document.querySelectorAll('.toggle-password');
            togglePasswordButtons.forEach(button => {
                button.addEventListener('click', function() {
                    const targetId = this.getAttribute('data-target');
                    const passwordInput = document.getElementById(targetId);
                    const eyeOpen = this.querySelector('.eye-open');
                    const eyeClosed = this.querySelector('.eye-closed');
                    
                    // åˆ‡æ¢å¯†ç æ˜¾ç¤ºç±»å‹
                    if (passwordInput.type === 'password') {
                        passwordInput.type = 'text';
                        eyeOpen.classList.add('hidden');
                        eyeClosed.classList.remove('hidden');
                    } else {
                        passwordInput.type = 'password';
                        eyeOpen.classList.remove('hidden');
                        eyeClosed.classList.add('hidden');
                    }
                });
            });
            
            // é¡µé¢åŠ è½½æ—¶è‡ªåŠ¨æ‰§è¡Œ
            // åŠ è½½ä¿å­˜çš„æ¨¡æ¿
            loadSavedTemplates();
            // åŠ è½½è‡ªå®šä¹‰CSS
            loadSavedCss();
        });
    </script>
</body>
</html>